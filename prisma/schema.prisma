generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id           Int                  @id @default(autoincrement())
  nome         String
  email        String               @unique
  senha        String
  cargo        String?
  departamento String?
  empresaId    Int?
  papelId      Int?                 // Novo campo para papel padrão
  isAdmin      Boolean              @default(false)
  isSuperAdmin Boolean              @default(false)
  ativo        Boolean              @default(true)
  ultimoAcesso DateTime?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  resetTokens  PasswordResetToken[]
  sessoes      SessaoUsuario[]
  permissoes   UsuarioPermissao[]
  empresa      Empresa?             @relation(fields: [empresaId], references: [id])
  papel        Papel?               @relation(fields: [papelId], references: [id])

  @@index([empresaId], map: "usuarios_empresaId_fkey")
  @@index([papelId], map: "usuarios_papelId_fkey")
  @@map("usuarios")
}

model Empresa {
  id        Int       @id @default(autoincrement())
  nome      String    @unique
  cnpj      String?   @unique
  endereco  String?
  telefone  String?
  email     String?
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  usuarios  Usuario[]

  @@map("empresas")
}

model UsuarioPermissao {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  permissao String   // read, write, delete, admin
  recurso   String   // menu, submenu, page, action
  valor     String?  // específico do recurso (ex: cores, familias)
  createdAt DateTime @default(now())
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, permissao, recurso, valor])
  @@map("usuario_permissoes")
}

model Papel {
  id          Int              @id @default(autoincrement())
  nome        String           @unique
  descricao   String?
  isSystem    Boolean          @default(false) // Papéis do sistema não podem ser deletados
  ativo       Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  usuarios    Usuario[]
  permissoes  PapelPermissao[]

  @@map("papeis")
}

model PapelPermissao {
  id        Int      @id @default(autoincrement())
  papelId   Int
  permissao String   // read, write, delete, admin
  recurso   String   // menu, submenu, page, action
  valor     String?  // específico do recurso (ex: cores, familias)
  createdAt DateTime @default(now())
  papel     Papel    @relation(fields: [papelId], references: [id], onDelete: Cascade)

  @@unique([papelId, permissao, recurso, valor])
  @@map("papel_permissoes")
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId], map: "password_reset_tokens_usuarioId_fkey")
  @@map("password_reset_tokens")
}

model SessaoUsuario {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId], map: "sessao_usuarios_usuarioId_fkey")
  @@map("sessao_usuarios")
}

model Cor {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  legado    String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  skus      SKU[]

  @@map("cores")
}

model Familia {
  id        Int      @id @default(autoincrement())
  codigo    String   @unique
  familia   String
  legado    String?
  skus      SKU[]

  @@map("familia")
}

model Tamanho {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  legado    String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  skus      SKU[]

  @@map("tamanhos")
}

model Deposito {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  legado    String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  skus      SKU[]

  @@map("depositos")
}

model UNEG {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  legado    String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  skus      SKU[]

  @@map("unegs")
}

model SKU {
  id         Int       @id @default(autoincrement())
  codigo     String    @unique
  nome       String
  corId      Int?
  familiaId  Int?
  tamanhoId  Int?
  depositoId Int?
  unegId     Int?
  ativo      Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  cor        Cor?      @relation(fields: [corId], references: [id])
  deposito   Deposito? @relation(fields: [depositoId], references: [id])
  familia    Familia?  @relation(fields: [familiaId], references: [id])
  tamanho    Tamanho?  @relation(fields: [tamanhoId], references: [id])
  uneg       UNEG?     @relation(fields: [unegId], references: [id])

  @@index([corId], map: "skus_corId_fkey")
  @@index([depositoId], map: "skus_depositoId_fkey")
  @@index([familiaId], map: "skus_familiaId_fkey")
  @@index([tamanhoId], map: "skus_tamanhoId_fkey")
  @@index([unegId], map: "skus_unegId_fkey")
  @@map("skus")
}

model Representante {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String?  @unique
  telefone  String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("representantes")
}

model Cliente {
  id        Int      @id @default(autoincrement())
  nome      String
  cnpj      String?  @unique
  email     String?
  telefone  String?
  endereco  String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("clientes")
}

model Fornecedor {
  id        Int      @id @default(autoincrement())
  nome      String
  cnpj      String?  @unique
  email     String?
  telefone  String?
  endereco  String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("fornecedores")
}

model Transportadora {
  id        Int      @id @default(autoincrement())
  nome      String
  cnpj      String?  @unique
  email     String?
  telefone  String?
  endereco  String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("transportadoras")
}

model TabelaDinamica {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  descricao String?
  estrutura Json?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tabelas_dinamicas")
}
